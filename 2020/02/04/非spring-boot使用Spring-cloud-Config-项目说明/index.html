<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config ) | 湖畔小屋</title><meta name="description" content="非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )"><meta name="keywords" content="spring cloud,config,spring"><meta name="author" content="美式不加糖"><meta name="copyright" content="美式不加糖"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )"><meta name="twitter:description" content="非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )"><meta property="og:url" content="http://yoursite.com/2020/02/04/%E9%9D%9Espring-boot%E4%BD%BF%E7%94%A8Spring-cloud-Config-%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E/"><meta property="og:site_name" content="湖畔小屋"><meta property="og:description" content="非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/02/04/%E9%9D%9Espring-boot%E4%BD%BF%E7%94%A8Spring-cloud-Config-%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E/"><link rel="prev" title="threadLocal学习" href="http://yoursite.com/2020/02/04/threadLocal%E5%AD%A6%E4%B9%A0/"><link rel="next" title="solr 相关度评分，自定义评分" href="http://yoursite.com/2020/02/04/solr-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E5%88%86/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">湖畔小屋</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">20</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config )</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-04<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-02-04</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/spring-cloud/">spring cloud</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/spring-cloud/config/">config</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/spring-cloud/config/spring/">spring</a></span><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><p>非spring boot 使用Spring cloud Config  (老版 spring  集成 spring cloud config ) || spring cloud config 搭建</p>
<p>背景：想自己搭建一个分布式的配置中心，发现spring Cloud Config 不错，（后台基于git，可以配置webhook 实现热更新、回滚，分环境配置等）与自己的期望相近。</p>
<p>虽然好用但是基于spring boot的，spring 与spring boot 还是有挺多巨别。为了能用在现有的 项目中，决定 想办法集成一下，百度 google 都没有现成的可以copy…</p>
<p>于是想自己实现下，查询之后 按照一个大神的想法实现了下。中间遇到许多问题，不过更加了解spring了 也会继续完善。java 新人 希望各位大神多多指导。</p>
<p>github：<a href="https://github.com/Eric-ly/hconfig" target="_blank" rel="noopener">https://github.com/Eric-ly/hconfig</a></p>
<p>后面有项目的测试说明：</p>
<p>实现结果：</p>
<p>在spring 中 使用spring Cloud Config 功能，分项目/环境 获取配置文件，自动注入，自动更新 spring boot的注解无法兼容 待稍后解决。</p>
<p>前提：</p>
<p>一个简单的spring spring MVC 项目。</p>
<p>config server 配置好，github 配置好。 这个网上百度就有很多。</p>
<p>（在搭建spring cloud config （server and client）后，搭建注册应用中心 eureka  和 rabbitMq 进行自动热更新。）</p>
<p>实现方式：</p>
<p>1.创建自定义的ApplicationContext，先通过在web.xml中设置 contextClass 来指定应用使用自定义的ApplicationContext，</p>
<p>2.在自定义的applicationContext中 覆写 创建environment的方法，用来定制 environment，把config server的配置信息加入 应用</p>
<p>3.自定义的CloudEnvironment extends StandardServletEnvironment，扩展customizePropertySources方法，指定 配置的来源，然后放入 propertySource的list中，作为整个项目的 配置之一。</p>
<p>4.自定义propertySouce ，使用spring cloud client的ConfigClientProperties 作为 propertySouce的来源， 然后添加到PropertySource中</p>
<p>5.自定义配置类，将配置中心的配置按照单个/model 进行注入</p>
<p>后期实现：</p>
<p>（1）兼容@refresh的注解，使 自动更新。</p>
<p>（2）通过修改name 获取多个配置文件。优化config server的文件</p>
<p>（3）细化 回滚功能</p>
<p>（4）写 拦截器，打成jar包，成为一个工具包，通过自定义注解 来使用。隐藏实现。成为一个通用的功能</p>
<p>最近有点忙，这个项目先达到能基本用，慢慢完善。</p>
<p>具体实现步骤：</p>
<p>1.增加pom 依赖，spring mvc ，spring cloud，logback 等</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><properties></properties></span><br><span class="line">    <spring.version>4.2.9.RELEASE</spring.version></span><br><span class="line">    <jstl.version>1.2</jstl.version></span><br><span class="line">    <junit.version>4.11</junit.version></span><br><span class="line">    <logback.version>1.0.13</logback.version></span><br><span class="line">    <jcl-over-slf4j.version>1.7.5</jcl-over-slf4j.version></span><br><span class="line">    <spring.cloud.version>1.2.0.RELEASE</spring.cloud.version></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><dependencies></dependencies></span><br><span class="line"></span><br><span class="line">    <!--    junit 依赖    --></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>junit</groupid></span><br><span class="line">        <artifactid>junit</artifactid></span><br><span class="line">        <version>${junit.version}</version></span><br><span class="line">        <!-- <scope>test</scope> --></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <!--    spring mvc 的 依赖--></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework</groupid></span><br><span class="line">        <artifactid>spring-webmvc</artifactid></span><br><span class="line">        <version>${spring.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework</groupid></span><br><span class="line">        <artifactid>spring-context</artifactid></span><br><span class="line">        <version>${spring.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework</groupid></span><br><span class="line">        <artifactid>spring-core</artifactid></span><br><span class="line">        <version>${spring.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework</groupid></span><br><span class="line">        <artifactid>spring-web</artifactid></span><br><span class="line">        <version>${spring.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <!--    spring cloud config client 依赖    --></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.springframework.cloud</groupid></span><br><span class="line">        <artifactid>spring-cloud-config-client</artifactid></span><br><span class="line">        <version>${spring.cloud.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <!--    logback --></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.slf4j</groupid></span><br><span class="line">        <artifactid>jcl-over-slf4j</artifactid></span><br><span class="line">        <version>${jcl-over-slf4j.version}</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>ch.qos.logback</groupid></span><br><span class="line">        <artifactid>logback-classic</artifactid></span><br><span class="line">        <version>${logback.version}</version></span><br><span class="line">    </span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>org.projectlombok</groupid></span><br><span class="line">        <artifactid>lombok</artifactid></span><br><span class="line">        <version>1.16.8</version></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <dependency></dependency></span><br><span class="line">        <groupid>javax.servlet</groupid></span><br><span class="line">        <artifactid>javax.servlet-api</artifactid></span><br><span class="line">        <version>3.1.0</version></span><br><span class="line">        <scope>provided</scope></span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure></div>



<p>2.创建自定义的ApplicationContext，先通过在web.xml中设置 contextClass 来指定自己的ApplicationContext，</p>
<!--    添加自定义的ApplicationContext--><context-param>   

<p><param-name>contextClass</param-name>   </p>
<p><param-value>org.lybm.hconfig.clientWosb.config.CustomWebApplicationContext</param-value></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext 是spring ioc 的体现，spring 中的容器。一般有几种实现。</span><br><span class="line">FileSystemXmlApplicationContext/ClassPathXmlApplicationContext/WebXmlApplicationContex</span><br><span class="line"></span><br><span class="line">我们在搭建框架的时候一般通过注册ContextLoaderListener 监听 去自动获取 初始化（这里先去通过classContext的配置获取，而且必须可以强转为WebXmlApplicationContxt，如果没设置 创建默认的）</span><br><span class="line">，这里为了使用spring boot的功能，我们需要自定义ApplicationContext</span><br></pre></td></tr></tbody></table></figure></div>

<p>在新定义的ApplicationContext 中我们使用自定义的Environment，为了把配置放到 environment中来使用。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class CustomWebApplicationContext extends XmlWebApplicationContext {</span><br><span class="line">	@Override</span><br><span class="line">    protected ConfigurableEnvironment createEnvironment() {</span><br><span class="line">        System.out.println("-------- loaded my CustomWebApplicationContext context");</span><br><span class="line">        return new CloudEnvironment();</span><br><span class="line">    }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div>



<p>3.创建 自定义的Environment，用来把 配置中心 config server的配置 放到环境中。</p>
<p>（1）重写定制方法</p>
<p>自定义的CloudEnvironment extends StandardServletEnvironment，扩展customizePropertySources方法，指定 配置的来源，然后放入 propertySource的list中，作为整个项目的 配置之一。</p>
<p>这里说一下，spring 的所有配置，包括system配置 ,jdni,自定义的properties等 都会放到 spring的environtment的propertySource的list中，用来使用。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void customizePropertySources(MutablePropertySources propertySources) {</span><br><span class="line">    super.customizePropertySources(propertySources);</span><br><span class="line">    try {</span><br><span class="line">        //用来添加应用名到environment中</span><br><span class="line">        propertySources.addLast( initResourcePropertySourceLocator() );</span><br><span class="line">        //添加config Server的配置</span><br><span class="line">        PropertySource<!--?--> source = initConfigServicePropertySourceLocator(this);</span><br><span class="line">        propertySources.addLast(source);</span><br><span class="line">    } catch (Exception ex) {</span><br><span class="line">        logger.warn("failed to initialize cloud config environment", ex);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<p>（2）获取 config server的 配置信息，生成propertySource ，创建一个来源。用到了spring cloud的方法</p>
<p>这里说明一下，在配置ConfigClientProperties 连接信息的时候， 后面的代码 会重新覆盖 applicationName 所以这里设置name是没有意义的。 会从environment 中 获取商品日嗯</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    private PropertySource<!--?--> initConfigServicePropertySourceLocator(Environment environment) {</span><br><span class="line"></span><br><span class="line">        ConfigClientProperties configClientProperties = new ConfigClientProperties(environment);</span><br><span class="line">        configClientProperties.setUri("http://localhost:9001/");</span><br><span class="line">//        configClientProperties.setName("config-client");</span><br><span class="line">        configClientProperties.setProfile("dev");</span><br><span class="line">        configClientProperties.setLabel("master");</span><br><span class="line"></span><br><span class="line">        logger.debug("will load the client configuration-------"+configClientProperties);</span><br><span class="line">        ConfigServicePropertySourceLocator configServicePropertySourceLocator =</span><br><span class="line">                new ConfigServicePropertySourceLocator(configClientProperties);</span><br><span class="line"></span><br><span class="line">        return configServicePropertySourceLocator.locate(environment);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>



<p>重新设置name的代码，如下， 这样会导致我们连接获取到的配置信息不正确。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">override.setName(</span><br><span class="line">		environment.resolvePlaceholders("${" + ConfigClientProperties.PREFIX</span><br><span class="line">				+ ".name:${spring.application.name:application}}"));</span><br></pre></td></tr></tbody></table></figure></div>

<p>于是，我在 进行这一步前 将正确的 name信息， 加入到environment中，就可以找到 正常使用。</p>
<p>（3）添加 应用相关配置 到environment中。</p>
<p>在查询相关源码后发现。我只需要 将一个resource 对象放入 environment的 资源 list中就可以，这里我新建一个properties，写入配置，然后封装成resource  就可以了。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloud-config-context.properties</span><br><span class="line">spring.application.name=config-client</span><br><span class="line">demo=demo</span><br></pre></td></tr></tbody></table></figure></div>

<p>具体实现：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	Resource resource = new DefaultResourceLoader(this.getClass().getClassLoader()).</span><br><span class="line">getResource("classpath:cloud-config-context.properties");</span><br><span class="line">	</span><br><span class="line">	resourcePropertySource = new ResourcePropertySource(resource);</span><br></pre></td></tr></tbody></table></figure></div>



<p>这里学习的过程 花费了一些时间。了解了 environment，propertySource 等spring 加载配置信息的代码。一些相关知识会在后续贴出来</p>
<p>4.现在environment 重写好了，创建配置信息类</p>
<p>我们目前可以通过两种方式获取配置，</p>
<p>（1）单个配置的获取。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    //单独一个字段的获取</span><br><span class="line">    @Value("${test}")</span><br><span class="line">    private String test;</span><br><span class="line"> 这么写 如果没有test ，程序会报错，启动不了， 所以 不要用这种写法</span><br><span class="line"> </span><br><span class="line">     //单独一个字段的获取</span><br><span class="line">    @Value("${xxx:x}")</span><br><span class="line">    private String test;</span><br><span class="line">单个字段 推荐这么写，如果xxx没有，则使用默认值x ，这样比较符合 业务场景</span><br></pre></td></tr></tbody></table></figure></div>



<p>（2）按照配置信息类 获取</p>
<p>如下，将配置信息映射成一个model，可以将统一前缀 如wosb的配置信息 放到一个类里，这样方便管理，在写配置的时候 也好区分，就像一个一个配置文件。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@ConfigurationProperties(prefix = "wosb")</span><br><span class="line">@Data</span><br><span class="line">public class WosbProperties {</span><br><span class="line">    private String test;</span><br><span class="line">    private String demo;</span><br><span class="line">    private String name;</span><br><span class="line">    private String paht;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<p>（2.2）将配置类 注入，两种方式，</p>
<p>a. 通过注解，增加@Configuration，将这个类注入到 容器中</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">注解定义</span><br><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Component</span><br><span class="line">public @interface Configuration {</span><br></pre></td></tr></tbody></table></figure></div>

<p>b.通过配置PropertySourcesPlaceHolderConfigurer，不太推荐</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties({WosbProperties.class})</span><br><span class="line">public class PropertiesConfigurer {</span><br><span class="line">    @Bean</span><br><span class="line">    public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {</span><br><span class="line">        return new PropertySourcesPlaceholderConfigurer();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<p>5.继承完成，使用/测试</p>
<p>（1）创建controller</p>
<p>（2）使用</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private SearchProperties searchProperties;</span><br><span class="line">//单独一个字段的获取</span><br><span class="line">@Value("${xxx:x}")</span><br><span class="line">private String test;</span><br></pre></td></tr></tbody></table></figure></div>

<p>（3）可以注入Environment env 来查看当前的environment信息。</p>
<p>项目说明：</p>
<p>github:<a href="https://github.com/Eric-ly/hconfig" target="_blank" rel="noopener">https://github.com/Eric-ly/hconfig</a></p>
<p>github的配置文件地址：<a href="https://github.com/Eric-ly/hconfig-properties" target="_blank" rel="noopener">https://github.com/Eric-ly/hconfig-properties</a></p>
<p>cloudeureka： spring boot的应用注册中心</p>
<p>ConfligClientNoSpringBoot： 非spring boot 应用 使用 应用配置中心</p>
<p>hconfigclient：spring boot的 应用配置中心的 客户端</p>
<p>hconfigserver：spring boot的 应用配置中心的服务端</p>
<p>使用说明：</p>
<p>1.启动 应用注册中心</p>
<p>（1）入口类：EurekaServerApplication    IDE debug 或者用命令</p>
<p>（2）配置：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line">eureka.instance.hostname=localhost</span><br></pre></td></tr></tbody></table></figure></div>



<p>2.启动 配置中心的服务端</p>
<p>（1）入口类：ConfigServerApplication</p>
<p>（2)配置：</p>
<p>端口：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-server</span><br><span class="line">server.port=9001</span><br></pre></td></tr></tbody></table></figure></div>

<p>gitlab ：来源</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.config.server.git.uri=https://github.com/Eric-ly/hconfig-properties.git</span><br><span class="line">spring.cloud.config.server.git.searchPaths=configRepo</span><br><span class="line">spring.cloud.config.server.git.username=</span><br><span class="line">spring.cloud.config.server.git.password=</span><br><span class="line"></span><br><span class="line">spring.cloud.config.server.git.basedir=src/main/resource/config</span><br><span class="line"># //加载到ConfigServer项目所在的本地目录的位置， 可以不用配置</span><br></pre></td></tr></tbody></table></figure></div>

<p>消息总线，用来自动热更新，配置的是mq的地址，需要自己启</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#   添加cloud bus 消息总线，配合webhook 实现 所有client的消息热更新</span><br><span class="line">spring.rabbitmq.host=localhost</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br><span class="line">## 刷新时，关闭安全验证</span><br><span class="line">management.security.enabled=false</span><br><span class="line">## 开启消息跟踪</span><br><span class="line">spring.cloud.bus.trace.enabled=true</span><br></pre></td></tr></tbody></table></figure></div>

<p>注册中心：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注册中心地址</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka/</span><br></pre></td></tr></tbody></table></figure></div>



<p>3.启动 非spring boot的 ConfligClientNoSpringBoot</p>
<p>（1）配置 应用名</p>
<p>cloud-config-context.properties</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-client</span><br></pre></td></tr></tbody></table></figure></div>

<p>（2）IDE添加tomcat，然后启动</p>
<p>（3）测试</p>
<p><a href="http://localhost:8888/hello" target="_blank" rel="noopener">http://localhost:8888/hello</a></p>
<p>结果：   配置文件都读取到了</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search-pproperties : collection :{{engine}} demo: {{solr}} ||| wosb-properties: demo : {{ a}} name: {{ wosb }} path: {{ /}} single value : test?{{ abcdegggg }}</span><br></pre></td></tr></tbody></table></figure></div>



<p>4.spring boot的 配置中新 客户端（ 自动热更新）hconfigclient</p>
<p>（1）入口类 entryApplication</p>
<p>（2）配置：</p>
<p>（1）  应用名+  配置中心的 服务端</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=config-client</span><br><span class="line">spring.cloud.config.label=master</span><br><span class="line">spring.cloud.config.profile=dev</span><br><span class="line">spring.cloud.config.uri= http://localhost:9001/</span><br><span class="line">server.port=8888</span><br></pre></td></tr></tbody></table></figure></div>

<p>（2）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注册中心地址</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka/</span><br></pre></td></tr></tbody></table></figure></div>

<p>（3）</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 刷新时，关闭安全验证</span><br><span class="line">management.security.enabled=false</span><br><span class="line">## 开启消息跟踪</span><br><span class="line">spring.cloud.bus.trace.enabled=true</span><br><span class="line"></span><br><span class="line">spring.rabbitmq.host=localhost</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=guest</span><br><span class="line">spring.rabbitmq.password=guest</span><br></pre></td></tr></tbody></table></figure></div>

<p>（4） 测试</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(提交代码触发post请求给bus/refresh ----server端接收到请求并发送给Spring Cloud Bus</span><br><span class="line">----Spring Cloud bus接到消息并通知给其它客户端 ----其它客户端接收到通知，请求Server端获取最新配置</span><br><span class="line">----全部客户端均获取到最新的配置)</span><br></pre></td></tr></tbody></table></figure></div>



</context-param></body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">美式不加糖</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/02/04/%E9%9D%9Espring-boot%E4%BD%BF%E7%94%A8Spring-cloud-Config-%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E/">http://yoursite.com/2020/02/04/%E9%9D%9Espring-boot%E4%BD%BF%E7%94%A8Spring-cloud-Config-%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">湖畔小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/spring-cloud/">spring cloud    </a><a class="post-meta__tags" href="/tags/config/">config    </a><a class="post-meta__tags" href="/tags/spring/">spring    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/02/04/threadLocal%E5%AD%A6%E4%B9%A0/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>threadLocal学习</span></div></a></div><div class="next-post pull_right"><a href="/2020/02/04/solr-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E5%88%86/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>solr 相关度评分，自定义评分</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2017/12/06/spring-cloud-config分布式配置中心/" title="spring cloud config 分布式配置中心"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2017-12-06</div><div class="relatedPosts_title">spring cloud config 分布式配置中心</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 美式不加糖</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>